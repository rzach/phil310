% phil310mcgill.tex
% master file to produce tet for McGill's Phil 310
\documentclass[letterpaper]{memoir}

% we're compiling from main directory
\newcommand{\olpath}{../../}

\usepackage{mathpazo}
\usepackage[scaled=0.95]{helvet}
\usepackage{courier}
\linespread{1.05} % Palatino looks better with this

\usepackage[pdftex,breaklinks,bookmarks,bookmarksopen,bookmarksopenlevel=1,colorlinks,linkcolor=blue]{hyperref}

\input{\olpath/sty/open-logic.sty}

% Defer problems

\makeatletter

\RequirePackage{etoolbox}
\RequirePackage{answers}

\def\solutionextension{prb}

\csundef{prob}
\csundef{endprob}
\csundef{probtag}
\csundef{endprobtag}

\Newassociation{prob}{probdeferred}{\jobname}
\Newassociation{probtag}{probdeferredtag}{\jobname}

% Redefine probdeferred as a theorem environment
%\csundef{probdeferred}
%\csundef{endprobdeferred}
%\csundef{c@probdeferred}

\renewenvironment{probdeferred}[1]{\begin{probd}}{\end{probd}}
%\renewenvironment{probdeferredtag}[2]{\def\probtags#2\iftag\probtags{\begin{probd}}{\supressenv{probdeferredtag}}}{\iftag\probtags{\end{probd}}{}}
\renewenvironment{probdeferredtag}[2]{\begin{probd}}{\end{probd}}

\declaretheorem[
  style=definition,
  name=Problem]{probd}
% answers writes current label as argument
%\apptocmd{\probdeferred}{\@gobble}{}{}

  \Opensolutionfile{\jobname}

% at the end of a \chapter command, open the solution file 
\renewcommand\memendofchapterhook{%
  \Writetofile{\jobname}{\protect\section*{Problems for Chapter~\thechapter}}}

\makeatother

%\includeonly{frontmatter,part1}
%\includeonly{part2}
\includeonly{part3}

\begin{document}

\include{frontmatter}

\mainmatter

\include{part1}

\include{part2}

\include{part3}

\Closesolutionfile{\jobname}

\backmatter

\chapter{Problems}

  \Readsolutionfile{\jobname}

\end{document}

